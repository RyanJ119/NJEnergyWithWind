## Setup

A Python virtual environment (*venv*) is needed in this directory to install TOPFARM and other dependencies. TOPFARM does not use the latest Python version; 3.10.8 has been used here.

In this directory:

1. `python3.10 -m venv .venv` (3.11 works too)
2. `source .venv/bin/activate`
3. `pip3 install pandas matplotlib topfarm numpy pillow shapely`

Additionally, an NREL API key and email is needed to download data. Store this in a plain text file named `api_key` (no file extension) with the key on the first line and the associated email on the second. An API key can be retrieved here: https://developer.nrel.gov/signup/

## preprocess.py

Downloads and caches wind data, and pre-processes it for use in the optimization process.

Usage: `python3.10 preprocess.py DIRECTIONS SPEEDS`

`DIRECTIONS`: number of directions treated as distinct â€” `SPEEDS`: number of wind speeds treated as distinct. Both parameters are optional and default to 16 and 9 respectively.

`sites/define` contains information about each wind lease area in New Jersey. `sites/define/areas.csv` contains the name and approximate midpoint of each lease area; the images depict each lease area's boundary where each pixel is 600 square metres. `preprocess.py` takes the information in `sites/define` and does the following for each lease area:

1. Traces the boundary of the lease area as a NumPy shape usable by TOPFARM
2. Downloads eight years of hourly wind speed/direction data (approx 13MB per site). Caches it to avoid re-downloading if running `preprocess` again
3. Constructs and saves histogram data for each available altitude as `histo_ALTITUDE.csv`, with frequency of each direction/speed combination

Information for a given site `ABCD` will be stored in `sites/ABCD/`

## settings.py
This file can be edited to change various aspects of the optimization process. This includes the maximum number of iterations that can be performed by the optimizer, the characteristics of the wind turbines, etc.

Documentation is inside the file.

## opt.py

Runs a turbine placement optimization process on a given lease area. The optimization uses the histogram data created by `preprocess` to weight the optimization value of speeds and directions. Optimization is made with respect to AEP.

Usage: `python3.10 opt.py LEASE_AREA [-o OUTPUT] [-l LAYOUT] [-e]`

`LEASE_AREA`: the name of the lease area being optimized (should match the data folder name in `sites/`).

`-o OUTPUT`: (Optional.) A filename for the optimized turbine layout to be written to. If not set, optimized layouts will go to `optimized/autosave_{LEASE_AREA}.npy`

`-l LAYOUT`: (Optional.) A filename for the starting layout which is optimized. This should be a numpy file with the same format that is written by this program. If this parameter is not set, a basic grid layout will be used. If you have an existing layout from an external source you wish to optimize, please contact me.

`-e`: (Optional.) If this flag is set, optimization will not happen. The program will instead simply print out the AEP of the starting layout and quit.

## viewer.py

Displays a wind turbine layout on top of a boundary polygon.

Usage: `python3 viewer.py LEASE_AREA LAYOUT_FILE`

Supply the lease area number (e.g. 0541) to get the boundary. The layout file is optional and should be a filename, in the same format output by the optimizer.

## histoviz.py

Displays the wind rose, representing the direction and speed bins used in the histograms generated by `preprocess` for a given lease area / altitude. Serves as a sanity check for `preprocess`.

Usage: `python3 histoviz.py LEASE_AREA ALTITUDE`